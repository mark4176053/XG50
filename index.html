<!-- owner:Tzuyi -->



<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>XG50抽籤筒</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #1d2b64, #f8cdda);
    color: #fff;
    margin: 0;
    padding: 20px;
  }
  h1 { text-align: center; margin-bottom: 20px; }
  .main-container {
    display: flex;
    gap: 20px;
    max-width: 1200px;
    margin: 0 auto;
    flex-wrap: wrap;
  }
  .left-container {
    flex: 1;
    min-width: 300px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  .box {
    background: rgba(255,255,255,0.9);
    color: #000;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  }
  .participant-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
  }
  .participant {
    background: #0066FF;
    color: #fff;
    padding: 8px 12px;
    border-radius: 10px;
    font-weight: bold;
    transition: transform 0.1s ease, background 0.1s ease;
  }
  .participant.active {
    background: #e91e63;
    transform: scale(1.3);
  }
  .participant.drawn {
    background: #ccc;
    color: #666;
    text-decoration: line-through;
  }
  .winner-card {
    background: #f8cdda;
    color: #000;
    padding: 10px;
    margin: 10px 0;
    border-radius: 10px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.2);
  }
  button {
    margin: 10px 5px 0 0;
    padding: 10px 20px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    background: #4CAF50;
    color: white;
    transition: transform 0.2s ease;
  }
  button:hover { transform: scale(1.05); }
  button.reset { background:#f44336; }
  input { margin:10px 0; padding:5px; border-radius:5px; border:1px solid #ccc; width:calc(25% - 12px); }
</style>
</head>
<body>
<h1>XG50抽籤筒</h1>
<div class="hint">請先設定好籤筒。設定完成後點選抽籤開始即可依序自動抽籤。</div>
  
<div class="main-container">
  <!-- 左側容器 -->
  <div class="left-container">
    <!-- 左上：參加者名單 + 按鈕 -->
    <div class="box">
      <h2>參加夥伴</h2>
      <div class="participant-list" id="participantList"></div>

      <div style="text-align:center; margin-top:15px;">
        <button onclick="startAutoDraw()">開始抽籤</button>
        <button onclick="resetLottery()" class="reset">重置</button>
        <div id="currentPrize" style="margin-top:10px;">按下開始抽獎</div>
        <div id="currentWinner" style="font-size:44px; margin-top:14px;"></div>
      </div>
    </div>

    <!-- 左下：獎項設定 -->
    <div class="box">
      <h2>籤筒</h2>
      <input type="text" id="prizeName" placeholder="項目">
      <input type="number" id="prizeCount" placeholder="名額" min="1">
      <button onclick="addPrize()">項目添加</button>
      <button onclick="resetPrizes()" class="reset">重置</button>
      <ul id="prizeList"></ul>
    </div>
  </div>

  <!-- 右側：歷史紀錄 -->
  <div class="box" style="flex:1; min-width:300px;">
    <h2>結果紀錄</h2>
    <div id="history"></div>
  </div>
</div>

<script>
let participants = [
  "國書","國庭","宇廷","彥儒","正邦","萬全",
  "枻承","宗瑜"
];

let prizes = [];
let drawn = [];

function renderParticipants() {
  const list = document.getElementById("participantList");
  list.innerHTML = "";
  participants.forEach(p=>{
    const div = document.createElement("div");
    div.className = "participant";
    div.innerText = p;
    if(drawn.includes(p)) div.classList.add("drawn");
    list.appendChild(div);
  });
}

function addPrize() {
  const name = document.getElementById("prizeName").value.trim();
  const count = parseInt(document.getElementById("prizeCount").value);
  if(!name || !count){ alert("請輸入完整獎項與名額"); return; }
  prizes.push({name,count,winners:[]});
  updatePrizeList();
  document.getElementById("prizeName").value="";
  document.getElementById("prizeCount").value="";
}

function updatePrizeList() {
  const ul = document.getElementById("prizeList");
  ul.innerHTML="";
  prizes.forEach(p=>{
    ul.innerHTML += `<li>${p.name} (${p.count} 名)</li>`;
  });
}

function resetPrizes(){
  prizes = [];
  updatePrizeList();
  updateHistory();
}

function updateHistory() {
  const histDiv = document.getElementById("history");
  histDiv.innerHTML="";
  prizes.forEach(p=>{
    if(p.winners.length>0){
      const div = document.createElement("div");
      div.className="winner-card";
      div.innerHTML = `<b>${p.name}:</b> ${p.winners.join("、")}`;
      histDiv.appendChild(div);
    }
  });
}

async function startAutoDraw() {
  if(prizes.length===0){ alert("請先設定獎項"); return; }
  for(let i=0;i<prizes.length;i++){
    let prize = prizes[i];
    for(let j=0;j<prize.count;j++){
      const winner = await drawWithEffect(prize.name);
      prize.winners.push(winner);
      drawn.push(winner);
      renderParticipants();
      updateHistory();
    }
  }
  document.getElementById("currentPrize").innerText="抽獎完成！";
  document.getElementById("currentWinner").innerText="";
}

function drawWithEffect(prizeName){
  return new Promise(resolve=>{
    const displayPrize = document.getElementById("currentPrize");
    displayPrize.innerText = `抽取：${prizeName}`;
    const displayWinner = document.getElementById("currentWinner");
    const available = participants.filter(p=>!drawn.includes(p));
    if(available.length===0){ resolve(null); return; }

    let i=0;
    const participantDivs = document.querySelectorAll(".participant");
    const interval = setInterval(()=>{
      const randomName = available[Math.floor(Math.random()*available.length)];
      displayWinner.innerText = randomName;
      participantDivs.forEach(div=>{
        div.classList.remove("active");
        if(div.innerText===randomName) div.classList.add("active");
      });
      i++;
      if(i>40){
        clearInterval(interval);
        participantDivs.forEach(div=>div.classList.remove("active"));
        resolve(randomName);
      }
    },100);
  });
}

function resetLottery(){
  drawn = [];
  prizes.forEach(p=>p.winners=[]);
  renderParticipants();
  updateHistory();
  document.getElementById("currentPrize").innerText="按下開始抽獎";
  document.getElementById("currentWinner").innerText="";
}

// 初始化
renderParticipants();
</script>
</body>
</html>

